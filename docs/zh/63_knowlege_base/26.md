# 文档解析方案和费用对比

[[toc]]

## 项目目标

本项目旨在构建一个功能完备的 RAG（Retrieval-Augmented Generation）系统，主要目标包括：

- **知识库管理**：支持创建、更新和删除知识库，便于用户高效维护内容。
- **文档处理**：包括文档的拆分、片段的向量化处理，以提升检索效率和准确性。
- **问答系统**：提供高效的向量检索和实时生成回答的能力，支持复杂汇总类问题的处理。
- **系统优化**：通过统计分析和推理问答调试，不断优化系统性能和用户体验。

## 系统核心概念

在 RAG 系统中，以下是几个核心概念：

- **应用**：知识库的集合。每个应用可以自定义提示词，以满足不同的个性化需求。
- **知识库**：由多个文档组成，便于用户对内容进行分类和管理。
- **文档**：系统中对应的真实文档内容。
- **片段**：文档经过拆分后的最小内容单元，用于更高效的处理和检索。

## 功能实现步骤

1. **数据库设计** [查看 01.md](./01.md)  
   设计并实现项目所需的数据表结构与数据库方案，为后续的数据操作打下坚实基础。

2. **用户登录** [查看 02.md](./02.md)  
   实现了安全可靠的用户认证系统，保护用户数据并限制未经授权的访问。

3. **模型管理** [查看 03.md](./03.md)  
   支持针对不同平台的模型（如 OpenAI、Google Gemini、Claude）进行管理与配置。

4. **知识库管理** [查看 04.md](./04.md)  
   提供创建、更新及删除知识库的功能，方便用户维护与管理文档内容。

5. **文档拆分** [查看 05.md](./05.md)  
   可将文档拆分为多个片段，便于后续向量化和检索操作。

6. **片段向量** [查看 06.md](./06.md)  
   将文本片段进行向量化处理，以便进行语义相似度计算及高效检索。

7. **命中率测试** [查看 07.md](./07.md)  
   通过语义相似度和 Top-N 算法，检索并返回与用户问题最相关的文档片段，用于评估检索的准确性。

8. **文档管理** [查看 08.md](./08.md)  
   提供上传和管理文档的功能，上传后可自动拆分为片段便于进一步处理。

9. **片段管理** [查看 09.md](./09.md)  
   允许对已拆分的片段进行增、删、改、查等操作，确保内容更新灵活可控。

10. **问题管理** [查看 10.md](./10.md)  
    为片段指定相关问题，以提升检索时的准确性与关联度。

11. **应用管理** [查看 11.md](./11.md)  
    提供创建和配置应用（智能体）的功能，并可关联指定模型和知识库。

12. **向量检索** [查看 12.md](./12.md)  
    基于语义相似度，在知识库中高效检索与用户问题最匹配的片段。

13. **推理问答调试** [查看 13.md](./13.md)  
    提供检索与问答性能的评估工具，帮助开发者进行系统优化与调试。

14. **对话问答** [查看 14.md](./14.md)  
    为用户提供友好的人机交互界面，结合检索到的片段与用户问题实时生成回答。

15. **统计分析** [查看 15.md](./15.md)  
    对用户的提问与系统回答进行数据化分析，并以可视化图表的形式呈现系统使用情况。

16. **用户管理** [查看 16.md](./16.md)  
    提供多用户管理功能，包括用户的增删改查及权限控制。

17. **API 管理** [查看 17.md](./17.md)  
    对外提供标准化 API，便于外部系统集成和调用本系统的功能。

18. **存储文件到 S3** [查看 18.md](./18.md)  
    将用户上传的文件存储至 S3 等对象存储平台，提升文件管理的灵活性与可扩展性。

19. **文档解析优化** [查看 19.md](./19.md)  
    介绍与对比常见的文档解析方案，并提供提升文档解析速度和准确性的优化建议。

20. **片段汇总** [查看 20.md](./20.md)  
    对片段内容进行汇总，以提升总结类问题的查询与回答效率。

21. **文档多分块与检索** [查看 21.md](./21.md)  
    将片段进一步拆分为句子并进行向量检索，提升检索的准确度与灵活度。

22. **多文档支持** [查看 22.md](./22.md)  
    兼容多种文档格式，包括 `.doc`, `.docx`, `.xls`, `.xlsx`, `.ppt`, `.pptx` 等。

23. **对话日志** [查看 23.md](./23.md)  
    记录并展示对话日志，用于后续分析和问题回溯。

24. **检索性能优化** [查看 24.md](./24.md)  
    提供整库扫描和分区检索等多种方式，进一步提高检索速度和效率。

25. **Milvus** [查看 25.md](./25.md)  
    将向量数据库切换至 Milvus，以在大规模向量检索场景中获得更佳的性能与可扩展性。

26. **文档解析方案和费用对比** [查看 26.md](./26.md)  
    对比不同文档解析方案在成本、速度、稳定性等方面的差异，为用户提供更加经济高效的选择。

27. **爬取网页数据** [查看 27.md](./27.md)  
    支持从网页中抓取所需内容，后续处理流程与本地文档一致：分段、向量化、存储与检索。

## openai 大模型方案

使用 GPT-4o 与 GPT-4o Mini 模型的价格计算与比较

### 概述

本文档旨在对比分析**GPT-4o**与**GPT-4o Mini**两种模型在特定使用场景下的费用情况。通过详细的价格计算，帮助用户选择最适合其需求的模型，以实现成本效益的最大化。

### 使用情况

```json
{
  "model": "gpt-4o-mini-2024-07-18",
  "system_fingerprint": "fp_9b78b61c52",
  "usage": {
    "completion_tokens": 571,
    "prompt_tokens": 25524,
    "total_tokens": 26095
  }
}
```

- **提示（输入）令牌数**：25,524 令牌
- **完成（输出）令牌数**：571 令牌

### GPT-4o 定价

#### 定价选项

1. **标准 API 定价（非批量）**

   - **输入令牌**：$2.50 / 1,000,000 令牌
   - **输出令牌**：$10.00 / 1,000,000 令牌

2. **批量 API 定价**
   - **输入令牌**：$1.25 / 1,000,000 令牌
   - **输出令牌**：$5.00 / 1,000,000 令牌

#### 费用计算

##### 1. 标准 API 定价

- **输入费用**：
  \[
  25,524 \text{ 令牌} \times \left( \frac{\$2.50}{1,000,000} \right) = \$0.06381
  \]
  约 **\$0.06381**（6.38 美分）

- **输出费用**：
  \[
  571 \text{ 令牌} \times \left( \frac{\$10.00}{1,000,000} \right) = \$0.00571
  \]
  约 **\$0.00571**（0.57 美分）

- **总费用**：
  \[
  \$0.06381 + \$0.00571 = \$0.0695
  \]
  约 **\$0.0695**（6.95 美分）

##### 2. 批量 API 定价

- **输入费用**：
  \[
  25,524 \text{ 令牌} \times \left( \frac{\$1.25}{1,000,000} \right) = \$0.031905
  \]
  约 **\$0.031905**（3.19 美分）

- **输出费用**：
  \[
  571 \text{ 令牌} \times \left( \frac{\$5.00}{1,000,000} \right) = \$0.002855
  \]
  约 **\$0.002855**（0.29 美分）

- **总费用**：
  \[
  \$0.031905 + \$0.002855 = \$0.03476
  \]
  约 **\$0.03476**（3.48 美分）

#### 总结

- **标准 API 定价**：约 **6.95 美分**
- **批量 API 定价**：约 **3.48 美分**

### GPT-4o Mini 定价

#### 定价选项

1. **标准 API 定价**

   - **输入令牌**：$0.150 / 1,000,000 令牌
   - **输出令牌**：$0.600 / 1,000,000 令牌

2. **批量 API 定价**
   - **输入令牌**：$0.075 / 1,000,000 令牌
   - **输出令牌**：$0.300 / 1,000,000 令牌

#### 费用计算

#### 1. 标准 API 定价

- **输入费用**：
  \[
  25,524 \text{ 令牌} \times \left( \frac{\$0.150}{1,000,000} \right) = \$0.0038286
  \]
  约 **\$0.00383**（0.38 美分）

- **输出费用**：
  \[
  571 \text{ 令牌} \times \left( \frac{\$0.600}{1,000,000} \right) = \$0.0003426
  \]
  约 **\$0.00034**（0.03 美分）

- **总费用**：
  \[
  \$0.00383 + \$0.00034 = \$0.00417
  \]
  约 **\$0.00417**（0.42 美分）

##### 2. 批量 API 定价

- **输入费用**：
  \[
  25,524 \text{ 令牌} \times \left( \frac{\$0.075}{1,000,000} \right) = \$0.0019143
  \]
  约 **\$0.00191**（0.19 美分）

- **输出费用**：
  \[
  571 \text{ 令牌} \times \left( \frac{\$0.300}{1,000,000} \right) = \$0.0001713
  \]
  约 **\$0.00017**（0.02 美分）

- **总费用**：
  \[
  \$0.00191 + \$0.00017 = \$0.00208
  \]
  约 **\$0.00208**（0.21 美分）

#### 总结

- **标准 API 定价**：约 **0.42 美分**
- **批量 API 定价**：约 **0.21 美分**

### 价格比较

#### 每令牌价格比较

- **输入令牌**：

  - GPT-4o / GPT-4o Mini = \$2.50 / \$0.150 ≈ **16.67 倍**
  - GPT-4o 批量 / GPT-4o Mini 批量 = \$1.25 / \$0.075 ≈ **16.67 倍**

- **输出令牌**：
  - GPT-4o / GPT-4o Mini = \$10.00 / \$0.600 ≈ **16.67 倍**
  - GPT-4o 批量 / GPT-4o Mini 批量 = \$5.00 / \$0.300 ≈ **16.67 倍**

#### 根据使用情况的总费用

- **GPT-4o 总费用**：

  - 标准 API 定价：\$0.0695
  - 批量 API 定价：\$0.03476

- **GPT-4o Mini 总费用**：
  - 标准 API 定价：\$0.00417
  - 批量 API 定价：\$0.00208

#### 费用倍数计算

- **标准 API 定价**：
  \[
  \frac{\$0.0695}{\$0.00417} ≈ 16.68
  \]
  即 **GPT-4o** 约 **16.7 倍** 于 **GPT-4o Mini**

- **批量 API 定价**：
  \[
  \frac{\$0.03476}{\$0.00208} ≈ 16.72
  \]
  即 **GPT-4o** 约 **16.7 倍** 于 **GPT-4o Mini**

#### 总结

- **GPT-4o** 的价格大约是 **GPT-4o Mini** 的 **16.7 倍**。
- 如果您的应用场景允许使用 **GPT-4o Mini**，您可以显著降低成本，同时仍然获得高效的性能。
- 对于高需求或需要更强大功能的场景，可以根据预算选择 **GPT-4o** 模型。

### 1 美元 和 1000 页

每页**0.42 美分**的解析成本，计算**1 美元**可以解析的页数以及**解析 1000 页**所需的费用：

#### **1. 1 美元可以解析多少页**

- **每页成本**：0.42 美分 = \$0.0042
- **计算方法**：

  \[
  \frac{\$1.00}{\$0.0042/\text{页}} \approx 238.10 \text{页}
  \]

- **结果**：**1 美元**大约可以解析 **238 页**。

#### **2. 解析 1000 页需要多少钱**

- **每页成本**：0.42 美分 = \$0.0042
- **计算方法**：

  \[
  1000 \text{页} \times \$0.0042/\text{页} = \$4.20
  \]

- **结果**：**解析 1000 页**需要 **\$4.20**。

---

#### **总结**

- **1 美元** 可以解析 **约 238 页**。
- **解析 1000 页** 的总费用为 **\$4.20**。

#### **建议**

- **大规模解析需求**：如果需要解析大量文档，可以根据上述计算估算所需的预算。例如，解析**10,000 页**大约需要 **\$42.00**。
- **成本优化**：如果解析页数持续增加，建议与服务提供商协商更优惠的批量定价，以进一步降低成本。

### 建议

- **成本敏感型用户**：优先考虑 **GPT-4o Mini**，特别是当批量 API 定价可用时，能够进一步降低成本。
- **高性能需求用户**：若应用场景对模型性能有更高要求，可以选择 **GPT-4o**，尽管成本较高，但能提供更强大的功能。
- **混合使用场景**：根据不同任务的需求，灵活选择两种模型，优化整体成本与性能的平衡。
