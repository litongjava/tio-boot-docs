# Tio Boot + Enjoyï¼šåˆ†é¡µä¸ SEO å®æˆ˜æŒ‡å—

## èƒŒæ™¯ä¸ç›®çš„

åœ¨æ„å»ºç°ä»£ Web åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦åŒæ—¶å…¼é¡¾ **æ€§èƒ½**ã€**ç”¨æˆ·ä½“éªŒ** å’Œ **æœç´¢å¼•æ“ä¼˜åŒ– (SEO)**ã€‚

* **æ€§èƒ½**ï¼šåç«¯è¦èƒ½é«˜æ•ˆåˆ†é¡µï¼Œé¿å…ä¸€æ¬¡æ€§è¿”å›æµ·é‡æ•°æ®ï¼Œä¿è¯å‰ç«¯åŠ è½½æµç•…ï¼›
* **ç”¨æˆ·ä½“éªŒ**ï¼šåˆ†é¡µå¯¼èˆªè¦ç›´è§‚ã€ç®€æ´ï¼Œæ”¯æŒé”®ç›˜å¿«æ·é”®ä¸è‡ªå®šä¹‰æ¯é¡µå¤§å°ï¼›
* **SEO**ï¼šé¡µé¢å†…å®¹åº”èƒ½è¢«æœç´¢å¼•æ“çˆ¬è™«ç›´æ¥è¯†åˆ«ï¼Œä¸ä¾èµ–å¤æ‚çš„ JavaScript åŠ¨æ€æ¸²æŸ“ã€‚

æœ¬æ–‡é¢å‘ä½¿ç”¨ **Tio Boot æ¡†æ¶** ä¸ **Enjoy æ¨¡æ¿å¼•æ“** çš„å¼€å‘è€…ï¼Œæä¾›ä¸€å¥—å®Œæ•´çš„**åˆ†é¡µå®ç°æ–¹æ¡ˆ**ï¼š

1. **åç«¯**

   * ä½¿ç”¨ `Db.paginate` ä¸ `Page<T>` å°è£…æŸ¥è¯¢ç»“æœï¼›
   * æä¾›æ€»é¡µæ•°ã€æ€»è®°å½•æ•°ç­‰åˆ†é¡µå…ƒä¿¡æ¯ï¼›
   * æ”¯æŒ `/{pageNo:\\d+}/{pageSize:\\d+}` è·¯ç”±ï¼Œçµæ´»è®¿é—® `/` æˆ–æŒ‡å®šåˆ†é¡µåœ°å€ï¼›

2. **å‰ç«¯æ¨¡æ¿**

   * é¦–é¡µä½¿ç”¨ `<a>` å¡ç‰‡é“¾æ¥è€Œé `onclick`ï¼Œè®©æœç´¢å¼•æ“å¯ç›´æ¥æŠ“å–ï¼›
   * æ”¯æŒåˆ†é¡µæ¡ã€æ€»é¡µæ•°/æ€»è®°å½•æ•°æ˜¾ç¤ºï¼›
   * æä¾›å“åº”å¼å¸ƒå±€å’Œé”®ç›˜å¿«æ·ç¿»é¡µã€‚

3. **SEO ä¼˜åŒ–**

   * é“¾æ¥é™æ€åŒ–ï¼ˆå¦‚ `/preview/123`ï¼‰ï¼›
   * é¦–é¡µå¡ç‰‡å†…å®¹å¯è¢«ç›´æ¥çˆ¬å–ï¼›
   * æ¨¡æ¿ä¸­åŒ…å« `<title>` ä¸ `<meta description>`ï¼Œåˆ©äºæœç´¢å¼•æ“æ”¶å½•ã€‚

é€šè¿‡æœ¬æ–‡ï¼Œä½ å¯ä»¥å¿«é€Ÿä¸ºè‡ªå·±çš„ Tio Boot é¡¹ç›®å¢åŠ ä¸€ä¸ª **å¯åˆ†é¡µã€å¯è¢«æœç´¢å¼•æ“æ”¶å½•** çš„é¦–é¡µä¸é¢„è§ˆé¡µé¢ï¼Œå…¼é¡¾ç”¨æˆ·ä½“éªŒä¸ SEO æ•ˆæœã€‚


æ¥ä¸‹æ¥çš„ç« èŠ‚ï¼Œé€æ­¥ä»‹ç» **æ‹¦æˆªå™¨ä¸è·¯ç”±é…ç½®**ã€**Handler**ã€**Service åˆ†é¡µé€»è¾‘**ã€**é¦–é¡µæ¨¡æ¿ index.html**ã€ä»¥åŠå¯é€‰çš„ **é¢„è§ˆé¡µä¼˜åŒ–**ã€‚


---

## 1. æ‹¦æˆªå™¨ä¸è·¯ç”±é…ç½®

### 1.1 æ”¾è¡Œè§„åˆ™ï¼ˆæ”¯æŒå¯é€‰æ®µï¼‰

å°†é¦–é¡µä¸è¯¦æƒ…é¡µåŠ å…¥ç™½åå•ï¼Œä¸”é¦–é¡µæ”¯æŒ `/{pageNo:\\d+}/{pageSize:\\d+}` å¯é€‰æ®µï¼ˆ`?` è¡¨ç¤ºè¯¥æ®µå¯çœç•¥ï¼Œæœ«å°¾è¿ç»­å¯é€‰ï¼‰ã€‚

```java
// Tio Boot Enjoy SEO
String[] permitUrls = { "/", "/{pageNo:\\d+}/{pageSize:\\d+}", "/preview/**", "/ping"};
new TioAdminInterceptorConfiguration(permitUrls).config();
```

> è¿™æ ·å³å¯é¿å…ä½¿ç”¨ `/**` å¤§èŒƒå›´æ”¾è¡Œï¼Œç²¾ç¡®æˆæƒé¦–é¡µä¸é¢„è§ˆé¡µã€‚

### 1.2 è·¯ç”±ï¼ˆåªéœ€ä¸¤æ¡ï¼‰

é¦–é¡µ 1 æ¡è·¯ç”±å³å¯è¦†ç›– `/` ä¸ `/pageNo/pageSize`ï¼›é¢„è§ˆé¡µæŒ‰ ID è®¿é—®ï¼š

```java
HttpRequestRouter r = server.getRequestRouter();
VideoPageHandler videoPageHandler = new VideoPageHandler();
r.add("/{pageNo:\\d+}/{pageSize:\\d+}", videoPageHandler::index);
r.add("/preview/{id}", videoPageHandler::preview);
```

> è‹¥ä½ å¸Œæœ›é¡µç /é¡µå¤§å°å¿…é¡»ä¸ºæ•°å­—ï¼Œå¯å†™æˆï¼š
> `/ {pageNo:\d+}? / {pageSize:\d+}?`

---

## 2. Handlerï¼šæ¥æ”¶å¯é€‰æ®µå‚æ•°å¹¶æ¸²æŸ“é¡µé¢

`VideoPageHandler` ä»è·¯ç”±æ³¨å…¥çš„ `pageNo/pageSize/id` ä¸­å–å€¼ï¼ˆä¸å­˜åœ¨åˆ™ç”¨é»˜è®¤å€¼ï¼‰ï¼Œè°ƒç”¨ Service æ¸²æŸ“ HTMLã€‚

```java
package com.litongjava.manim.handler;

import com.litongjava.jfinal.aop.Aop;
import com.litongjava.manim.services.VideoPageService;
import com.litongjava.tio.boot.http.TioRequestContext;
import com.litongjava.tio.http.common.HttpRequest;
import com.litongjava.tio.http.common.HttpResponse;
import com.litongjava.tio.http.server.util.Resps;

import lombok.extern.slf4j.Slf4j;

@Slf4j
public class VideoPageHandler {

  VideoPageService srv = Aop.get(VideoPageService.class);

  public HttpResponse index(HttpRequest request) {
    HttpResponse response = TioRequestContext.getResponse();

    Integer pageNo = null;
    Integer pageSize = null;
    try {
      pageNo = request.getInt("pageNo", 1);
      pageSize = request.getInt("pageSize", 10);
    } catch (Exception e) {
      return null; // è¿”å› null äº¤ç”±åç»­é“¾è·¯ï¼ˆå¦‚ 404/500ï¼‰å¤„ç†
    }

    VideoPageService indexService = Aop.get(VideoPageService.class);
    String html = indexService.index(pageNo, pageSize);
    Resps.html(response, html);
    return response;
  }

  public HttpResponse preview(HttpRequest request) {
    Long id = request.getLong("id");
    HttpResponse response = TioRequestContext.getResponse();
    String html = srv.getPreviewHtmlById(id);
    return Resps.html(response, html);
  }
}
```

---

## 3. Serviceï¼šåˆ†é¡µæŸ¥è¯¢ä¸æ¨¡æ¿å˜é‡æ³¨å…¥

åˆ©ç”¨å·²æœ‰çš„ `Page<T>` ä¸ `Db.paginate(...)`ï¼Œä¸€æ¬¡æ€§æŠŠåˆ†é¡µå˜é‡ï¼ˆå¦‚ `totalPage/totalRow/hasPrev/hasNext` ç­‰ï¼‰æ³¨å…¥æ¨¡æ¿ï¼Œé¡µé¢é€»è¾‘æ›´ç®€æ´ã€‚

```java
package com.litongjava.manim.services;

import java.util.List;

import com.jfinal.kit.Kv;
import com.litongjava.db.SqlPara;
import com.litongjava.db.activerecord.Db;
import com.litongjava.db.activerecord.Row;
import com.litongjava.jfinal.aop.Aop;
import com.litongjava.manim.consts.EfTableName;
import com.litongjava.model.page.Page;
import com.litongjava.template.EnjoyTemplate;

public class VideoPageService {

  VideoService videoService = Aop.get(VideoService.class);

  /** æ¸²æŸ“é¦–é¡µ */
  public String index(int pageNo, int pageSize) {
    pageNo  = Math.max(1, pageNo);
    pageSize = Math.max(1, pageSize);

    // æ³¨æ„ï¼šDb.paginate ä¼šè‡ªåŠ¨æ‹¼æ¥ limit/offset
    String sql = "select id,topic,language,view_count,create_time from %s where video_url is not null order by id";
    sql = String.format(sql, EfTableName.ef_generated_video);
    SqlPara sqlPara = SqlPara.by(sql);

    Page<Row> page = Db.paginate(pageNo, pageSize, sqlPara);
    List<Row> data = page.getList();

    int pn = page.getPageNumber();
    int ps = page.getPageSize();
    int tp = page.getTotalPage();
    int tr = page.getTotalRow();

    boolean hasPrev = pn > 1;
    boolean hasNext = pn < Math.max(1, tp);

    int prevPage = hasPrev ? (pn - 1) : 1;
    int nextPage = hasNext ? (pn + 1) : pn;

    Kv kv = Kv.by("data", data)
        .set("pageNo", pn).set("pageSize", ps)
        .set("totalPage", tp).set("totalRow", tr)
        .set("hasPrev", hasPrev).set("hasNext", hasNext)
        .set("prevPage", prevPage).set("nextPage", nextPage);

    return EnjoyTemplate.renderToString("index.html", kv);
  }

  /** æ¸²æŸ“é¢„è§ˆé¡µ */
  public String getPreviewHtmlById(Long id) {
    Row row = Db.findById(EfTableName.ef_generated_video, id);
    Kv kv;
    if (row != null) {
      kv = row.toKv();
      videoService.convert(kv);
      kv.set("answer", Aop.get(AnswerService.class).queryAnserById(id));
      List<String> transcript = Aop.get(ManimSceneCodeService.class).getTranscriptByGroupId(id);
      String subTitle = String.join("", transcript);
      kv.set("transcript", subTitle);
    } else {
      kv = Kv.by("title", "Not Found");
    }
    return EnjoyTemplate.renderToString("preview.html", kv);
  }
}
```

> è‹¥è¦æœ€æ–°åœ¨å‰ï¼ŒSQL æ”¹ä¸º `order by id desc`ï¼›
> æ¨¡æ¿å˜é‡ `totalPage` ä¸ `totalRow` å·²æ³¨å…¥ï¼Œå¯ç›´æ¥ç”¨äºæ˜¾ç¤ºã€‚

---

## 4. é¦–é¡µæ¨¡æ¿ï¼š`index.html`ï¼ˆå¯çˆ¬å– + åˆ†é¡µï¼‰

* å¡ç‰‡æ”¹ä¸º `<a>`ï¼Œä¾¿äº SEO çˆ¬å–ä¸å¯è®¿é—®æ€§ã€‚
* åº•éƒ¨åˆ†é¡µæ¡ç›´æ¥è·³è½¬ `/{pageNo}/{pageSize}`ã€‚
* æ–‡æœ«æ˜¾ç¤ºå½“å‰é¡µã€æ€»é¡µã€æ€»æ¡ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study11 Learning Platform</title>
    <meta name="description" content="Study11 â€” Explaining knowledge through animations. Browse generated videos with topics and languages.">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh; padding:20px;
        }
        .container { max-width:1200px; margin:0 auto; }
        .header { text-align:center;}
        .header h1 {
            color:#fff; font-size:2.5rem; margin-bottom:10px;
            text-shadow:2px 2px 4px rgba(0,0,0,.3);
        }
        .header p { color:rgba(255,255,255,.9); font-size:1.1rem; max-width:600px; margin:0 auto; }

        .content-grid {
            display:grid; grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
            gap:25px; padding:20px 0;
        }

        /* å¡ç‰‡ä¸º <a>ï¼Œæ–¹ä¾¿ SEO */
        .card {
            display:block;
            background:#fff; border-radius:15px; padding:25px;
            box-shadow:0 10px 30px rgba(0,0,0,.15);
            transition:all .3s ease; position:relative; overflow:hidden;
            text-decoration:none; color:inherit; cursor:pointer;
        }
        .card:hover { transform: translateY(-5px); box-shadow:0 15px 40px rgba(0,0,0,.25); }
        .card::before { content:''; position:absolute; top:0; left:0; right:0; height:4px;
            background:linear-gradient(90deg,#667eea,#764ba2); }

        .card-title {
            font-size:1.4rem; color:#333; margin-bottom:15px; line-height:1.4; transition:color .3s ease;
            white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
        }
        .card:hover .card-title { color:#667eea; }

        .card-meta {
            display:flex; justify-content:space-between; align-items:center;
            margin-top:20px; padding-top:15px; border-top:1px solid #eee;
        }
        .card-language {
            background:linear-gradient(45deg,#667eea,#764ba2); color:#fff;
            padding:6px 12px; border-radius:20px; font-size:.85rem; font-weight:500;
        }
        .card-views { color:#666; font-size:.9rem; display:flex; align-items:center; gap:5px; }
        .card-time { color:#999; font-size:.85rem; margin-top:8px; font-style:italic; }

        .empty-state { text-align:center; color:#fff; padding:60px 20px; grid-column:1 / -1; }
        .empty-state h2 { font-size:1.5rem; margin-bottom:10px; }

        @media (max-width:768px) {
            .content-grid { grid-template-columns:1fr; gap:20px; }
            .header h1 { font-size:2rem; }
            .card { padding:20px; }
        }
        .view-icon { width:16px; height:16px; display:inline-block; vertical-align:middle; margin-right:5px; }

        /* åˆ†é¡µæ¡ */
        .pagination {
          display:flex; gap:10px; justify-content:center; align-items:center;
          margin: 24px 0 8px;
        }
        .pag-btn {
          padding:8px 14px; border:0; border-radius:10px; cursor:pointer;
          background:#fff; box-shadow:0 6px 18px rgba(0,0,0,.12);
          font-weight:600; transition: transform .15s ease, box-shadow .15s ease;
          text-decoration:none; color:#333;
        }
        .pag-btn:hover { transform: translateY(-2px); box-shadow:0 10px 24px rgba(0,0,0,.18); }
        .pag-btn[disabled] { opacity:.45; cursor:not-allowed; transform:none; box-shadow:none; }
        .page-info { color:#fff; font-size:.95rem; margin:6px 0 0; text-align:center; opacity:.9; }
        .size-select {
          padding:8px 10px; border-radius:10px; border:0; outline:none;
          box-shadow:0 6px 18px rgba(0,0,0,.12); background:#fff; font-weight:600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Study11 Learning Platform</h1>
            <p>Explaining knowledge through animations</p>
        </div>

        <div class="content-grid">
            #if(data && data.size() > 0)
                #for(item : data)
                <a class="card" href="/preview/#(item.id)" aria-label="Open #(item.topic)">
                    <h3 class="card-title">#(item.topic)</h3>
                    <div class="card-time">Created: #date(item.create_time, "yyyy-MM-dd HH:mm:ss")</div>
                    <div class="card-meta">
                        <span class="card-language">#(item.language??"Unknown")</span>
                        <span class="card-views">
                            <svg class="view-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                            </svg>
                            #(item.view_count??0) views
                        </span>
                    </div>
                </a>
                #end
            #else
                <div class="empty-state">
                    <h2>No Data Available</h2>
                    <p>There is no learning content yet. Please check back later.</p>
                </div>
            #end
        </div>

        <!-- åˆ†é¡µæ¡ -->
        <div class="pagination">
          #if(hasPrev)
            <a class="pag-btn" href="/#(prevPage)/#(pageSize)">â† Prev</a>
          #else
            <button class="pag-btn" disabled>â† Prev</button>
          #end

          <span class="pag-btn" style="pointer-events:none;">Page&nbsp;#(pageNo)</span>

          #if(hasNext)
            <a class="pag-btn" href="/#(nextPage)/#(pageSize)">Next â†’</a>
          #else
            <button class="pag-btn" disabled>Next â†’</button>
          #end

          <select id="sizeSelect" class="size-select" onchange="onPageSizeChange(this.value)">
            <option value="10"  #(pageSize==10  ? 'selected' : '')>10 / page</option>
            <option value="20"  #(pageSize==20  ? 'selected' : '')>20 / page</option>
            <option value="50"  #(pageSize==50  ? 'selected' : '')>50 / page</option>
            <option value="100" #(pageSize==100 ? 'selected' : '')>100 / page</option>
          </select>
        </div>
        <p class="page-info">
          Page #(pageNo) of #(totalPage) &nbsp; | &nbsp;
          Total #(totalRow) records
        </p>
    </div>

    <script>
        // ä»…è´Ÿè´£ hover åŠ¨ç”»
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function(){ this.style.transform = 'translateY(-5px)'; });
                card.addEventListener('mouseleave', function(){ this.style.transform = 'translateY(0)'; });
            });
        });

        function onPageSizeChange(size){
          var pageNo = #(pageNo);
          var s = parseInt(size,10) || 10;
          location.href = '/' + pageNo + '/' + s;
        }

        // é”®ç›˜ â† â†’ å¿«æ·ç¿»é¡µï¼ˆå¯é€‰ï¼‰
        document.addEventListener('keydown', function(e){
          if (e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.isContentEditable)) return;
          if (e.key === 'ArrowLeft'  && #(hasPrev)) location.href = '/#(prevPage)/#(pageSize)';
          if (e.key === 'ArrowRight' && #(hasNext)) location.href = '/#(nextPage)/#(pageSize)';
        });
    </script>
</body>
</html>
```

---

## 5. é¢„è§ˆé¡µ

`preview.html`ï¼Œåšåˆ°ï¼š

* `<a href="/preview/{id}">` èƒ½ SSR æ¸²æŸ“å‡ºå¯ç´¢å¼•çš„ 200 HTMLï¼ˆä½ ç°åœ¨å°±æ˜¯ï¼‰ï¼›
* `<title>` ä¸ `<meta name="description">` ä½¿ç”¨ `title/description` æ¨¡æ¿å˜é‡ï¼›
* åœ°åŠ  `<link rel="canonical" href="/preview/{id}">` å’Œç»“æ„åŒ–æ•°æ®ï¼ˆ`VideoObject`ï¼‰ï¼Œåˆ©äºæ”¶å½•ã€‚

```html
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>#(title)</title>
  <meta name="description">#(transcript)</description>
  <link rel="canonical" href="/preview/#(id)">

  <!-- DPlayer & HLS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>

  <!-- KaTeX for math -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <!-- Marked (Markdown æ¸²æŸ“) + Prism (ä»£ç é«˜äº®) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-okaidia.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markup.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-typescript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-java.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>
  <style>
    /* ========== é¡µé¢æ ·å¼ï¼ˆä» React ç‰ˆæœ¬ç§»æ¤å¹¶ç®€åŒ–ï¼‰ ========== */
    :root{--indigo:#4f46e5;--text:#334155;--muted:#64748b}
    body{margin:0;background:#f8fafc;color:#333;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif}
    .page{max-width:1200px;margin:0 auto;padding:20px;min-height:100vh}
    .header{display:flex;align-items:center;gap:20px;margin:10px 0 20px}
    .back{background:transparent;border:none;color:var(--indigo);padding:8px 16px;border-radius:8px;cursor:pointer}
    .back:hover{background:#eef2ff}
    h1{margin:0;font-size:24px;color:#1e293b}

    .video-card{position:relative;background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 10px 25px rgba(0,0,0,.05);margin-bottom:20px}
    .video-card::before{content:"";display:block;padding-top:56.25%}
    #dplayer{position:absolute;inset:0}

    .tabs{display:flex;gap:8px;margin:14px 0}
    .tab{flex:1;padding:14px;background:#f1f5f9;border:none;border-radius:12px;color:#64748b;font-weight:600;cursor:pointer}
    .tab.active{background:var(--indigo);color:#fff}

    .panel{background:#fff;border-radius:16px;padding:24px;box-shadow:0 10px 25px rgba(0,0,0,.05);margin-bottom:24px}
    .section{background:#f8fafc;border-radius:12px;padding:18px}
    .section h3{margin:0 0 12px;color:#1e293b}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .item{background:#fff;border-radius:12px;padding:16px;box-shadow:0 4px 6px rgba(0,0,0,.03)}
    .item label{display:flex;align-items:center;justify-content:space-between;color:#475569;font-weight:600;margin-bottom:6px}
    .link{display:block;color:var(--indigo);overflow-wrap:anywhere;text-decoration:none}
    .link:hover{text-decoration:underline}

    .copy{margin-left:8px;border:none;border-radius:6px;background:#e2e8f0;padding:4px 8px;font-size:12px;cursor:pointer}
    .copy:hover{background:#cbd5e1}

    .answer{white-space:pre-wrap;line-height:1.65;color:var(--text);background:#fff;border-radius:8px;padding:16px;max-height:420px;overflow:auto}
    .table-wrap{overflow:auto;margin:12px 0}
    table{width:100%;border-collapse:collapse;background:#fff}
    th,td{border:1px solid #e5e7eb;padding:10px 12px;text-align:left}
    th{background:#f8f9fa}

    .trans{list-style:none;margin:0;padding:0}
    .trans li{display:flex;gap:10px;padding:10px 0;border-bottom:1px solid #e5e7eb}
    .ln{min-width:28px;font-weight:600}

    @media (max-width:768px){.page{padding:14px}.tabs{flex-direction:column}}
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <button class="back" onclick="history.back()">â† è¿”å›</button>
      <h1 id="title">#(title)</h1>
    </div>

    <div class="video-card"><div id="dplayer"></div></div>

    <div class="tabs">
      <button class="tab active" data-tab="info">ğŸ“‹ ä¿¡æ¯</button>
      <button class="tab" data-tab="answer">ğŸ’¬ ç­”æ¡ˆ</button>
      <button class="tab" data-tab="transcript">ğŸ“ å­—å¹•</button>
    </div>

    <!-- ä¿¡æ¯é¢æ¿ -->
    <div class="panel" id="panel-info">
      <div class="section">
        <h3>è§†é¢‘ä¿¡æ¯</h3>
        <div class="grid">
          <div class="item">
            <label>è§†é¢‘åœ°å€ <button class="copy" data-copy="videoUrl">å¤åˆ¶</button></label>
            <a id="video-link" class="link" href="#" target="_blank" rel="noopener"></a>
          </div>
          <div class="item">
            <label>å°é¢åœ°å€ <button class="copy" data-copy="coverUrl">å¤åˆ¶</button></label>
            <a id="cover-link" class="link" href="#" target="_blank" rel="noopener"></a>
          </div>
          <div class="item">
            <label>Provider</label>
            <div id="provider" style="font-weight:600;color:#334155;background:#ede9fe;padding:6px 10px;border-radius:6px;display:inline-block">#(provider)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç­”æ¡ˆé¢æ¿ -->
    <div class="panel" id="panel-answer" style="display:none">
      <div class="section">
        <h3 style="display:flex;align-items:center;justify-content:space-between">ç­”æ¡ˆæ–‡æœ¬ <button class="copy" data-copy="answer">å¤åˆ¶</button></h3>
        <div id="answer" class="answer"></div>
      </div>
    </div>

    <!-- å­—å¹•é¢æ¿ -->
    <div class="panel" id="panel-transcript" style="display:none">
      <div class="section">
        <h3 style="display:flex;align-items:center;justify-content:space-between">è§†é¢‘å­—å¹• <button class="copy" data-copy="transcript">å¤åˆ¶</button></h3>
        <ul id="transcript" class="trans"><span class="ln"> #(transcript) </span></ul>
      </div>
    </div>
  </div>

  <script>
    // ===================== å¯è¢« Enjoy æ³¨å…¥çš„å ä½å˜é‡ =====================
    // å¿…å¡«ï¼šè§†é¢‘ URLï¼ˆæ”¯æŒ .m3u8ï¼‰
    const VIDEO_URL = '#(video_url)';
    // å¯é€‰ï¼šå°é¢å›¾ç‰‡ URL
    const COVER_URL = '#(cover_url)';
    // Provider ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    const PROVIDER = '#(provider)';
    // ç­”æ¡ˆ Markdown æ–‡æœ¬ï¼ˆå¯åŒ…å«è¡Œå†…/å—çº§ LaTeXï¼Œå¦‚ $x^2$ã€$$\int...$$ï¼‰
    const ANSWER_MARKDOWN = `answer`;

    // ===================== å·¥å…·å‡½æ•° =====================
    function setText(id, text){ const el=document.getElementById(id); if(el) el.textContent = text || ''; }
    function setLink(id, href){ const el=document.getElementById(id); if(!el) return; if(href){ el.href = href; el.textContent = href; } else { el.textContent = 'æ— '; el.removeAttribute('href'); } }
    function copy(text){ if(!text) return; navigator.clipboard && navigator.clipboard.writeText(text); }

    // Markdown æ¸²æŸ“ï¼ˆå€ŸåŠ© Marked + Prism + KaTeXï¼‰
    function renderMarkdownTo(targetEl, md){
      if(!targetEl) return;
      // æ”¯æŒ \( \) ä¸ \[ \] è½¬æ¢
      md = md || '';
      md = md.replace(/\\\((.*?)\\\)/g, '$$$1$$');
      md = md.replace(/\\\[(.*?)\\\]/gs, '$$$$\n$1\n$$$$');
      // æ¸²æŸ“ä¸º HTML
      const html = marked.parse(md, { breaks:true, gfm:true, headerIds:true, mangle:false, highlight(code, lang){
        try{ if(lang && Prism.languages[lang]){ return Prism.highlight(code, Prism.languages[lang], lang); } }
        catch(e){}
        return code;
      }});
      targetEl.innerHTML = html;
      // æ¸²æŸ“å…¬å¼
      try{ renderMathInElement(targetEl, { delimiters:[ {left:'$$', right:'$$', display:true}, {left:'$', right:'$', display:false} ], throwOnError:false }); }catch(e){}
    }

    // Tabs åˆ‡æ¢
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.getAttribute('data-tab');
        ['info','answer','transcript'].forEach(name=>{
          const p = document.getElementById('panel-'+name);
          if(p) p.style.display = (name===tab)?'block':'none';
        });
      });
    });

    // å¤åˆ¶æŒ‰é’®
    document.querySelectorAll('.copy').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const key = btn.getAttribute('data-copy');
        if(key==='videoUrl') copy(VIDEO_URL);
        else if(key==='coverUrl') copy(COVER_URL);
        else if(key==='answer') copy(ANSWER_MARKDOWN);
        else if(key==='transcript') copy(tryParseTranscript().join('\n'));
        btn.textContent = 'âœ“ å·²å¤åˆ¶';
        setTimeout(()=>btn.textContent='å¤åˆ¶',1500);
      });
    });

    // åˆå§‹åŒ–é™æ€ä¿¡æ¯
    setText('title', #(titile));
    setLink('video-link', VIDEO_URL);
    setLink('cover-link', COVER_URL);
    if(PROVIDER && PROVIDER !== '#(provider)') { setText('provider', PROVIDER); }

    // æ¸²æŸ“ç­”æ¡ˆä¸å­—å¹•
    renderMarkdownTo(document.getElementById('answer'), ANSWER_MARKDOWN);

    // HTML è½¬ä¹‰ï¼ˆé˜² XSSï¼‰
    function escapeHtml(str){ return String(str||'').replace(/[&<>"']/g,(ch)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[ch])); }

    // åˆå§‹åŒ– DPlayerï¼ˆæ”¯æŒ HLSï¼‰
    (function initPlayer(){
      if(!VIDEO_URL || VIDEO_URL === '#(videoUrl)'){ return; }
      let type = 'auto';
      if(/\.m3u8($|\?)/i.test(VIDEO_URL)){
        type = 'hls';
        window.Hls = window.Hls || Hls; // æä¾›ç»™ DPlayer
      }
      const dp = new DPlayer({
        container: document.getElementById('dplayer'),
        autoplay: false,
        preload: 'auto',
        video: { url: VIDEO_URL, pic: (COVER_URL && COVER_URL !== '#(cover_url)') ? COVER_URL : 'https://via.placeholder.com/800x450?text=Video+Cover', type },
        pluginOptions: { hls: { debug:false, enableWorker:true, lowLatencyMode:true, maxBufferLength:60, maxMaxBufferLength:600, maxBufferSize:50*1000*1000, liveSyncDurationCount:3, liveMaxLatencyDurationCount:10 } }
      });
      if(type==='hls' && dp.video){
        dp.video.addEventListener('loadedmetadata', ()=>{ dp.video.currentTime = 0.1; dp.play(); });
      }
    })();
  </script>
</body>
</html>
```

---
## 7. ç»“è¯­

* **åç«¯**ï¼š`Db.paginate + Page<T>` â†’ æ³¨å…¥ `pageNo/pageSize/totalPage/totalRow/hasPrev/hasNext`ï¼›
* **è·¯ç”±**ï¼šä¸€æ¡ `/{pageNo:\\d+}/{pageSize:\\d+}` è¦†ç›– `/` ä¸åˆ†é¡µï¼›
* **å‰ç«¯**ï¼šå¡ç‰‡ä½¿ç”¨ `<a>`ï¼Œåˆ†é¡µè·³è½¬å³åˆ»ç”Ÿæ•ˆï¼Œåº•éƒ¨æ˜¾ç¤ºâ€œç¬¬å‡ é¡µ / æ€»é¡µæ•° / æ€»æ¡æ•°â€ã€‚

