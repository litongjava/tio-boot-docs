# tio-boot vs Quarkus æ€§èƒ½å¯¹æ¯”æµ‹è¯•æŠ¥å‘Š

## 1. æµ‹è¯•ç›®çš„

å¯¹æ¯” **tio-boot** ä¸ **Quarkus** åœ¨ç›¸åŒç¡¬ä»¶ç¯å¢ƒã€ç›¸åŒå¹¶å‘æ¨¡å‹ä¸‹çš„ HTTP `/plaintext` æ¥å£æ€§èƒ½ï¼Œé‡ç‚¹å…³æ³¨ï¼š

* ååé‡ï¼ˆRequests Per Second, RPSï¼‰
* å¹³å‡å»¶è¿Ÿ
* å°¾å»¶è¿Ÿï¼ˆP99 / Maxï¼‰
* åœ¨ Keep-Alive åœºæ™¯ä¸‹çš„ç¨³å®šæ€§

è¯¥æµ‹è¯•ä¸»è¦åæ˜  **ç½‘ç»œæ¡†æ¶ä¸æ‰§è¡Œé“¾è·¯çš„æé™æ€§èƒ½**ï¼Œä¸æ¶‰åŠæ•°æ®åº“ã€ç£ç›˜ IO ç­‰ä¸šåŠ¡é€»è¾‘ã€‚

---

## 2. æµ‹è¯•ç¯å¢ƒ

* æ“ä½œç³»ç»Ÿï¼šLinuxï¼ˆDebianï¼‰
* CPUï¼š16 æ ¸
* ç½‘ç»œï¼šæœ¬åœ°å›ç¯ï¼ˆ127.0.0.1ï¼‰
* å‹æµ‹å·¥å…·ï¼šApacheBench 2.3
* JVMï¼šæ”¯æŒè™šæ‹Ÿçº¿ç¨‹ï¼ˆJDK 21+ï¼‰
* å¹¶å‘å‚æ•°ï¼š

  * `-n 1000000`
  * `-c 100`
  * `-k`ï¼ˆKeep-Alive å¼€å¯ï¼‰

---

## 3. æµ‹è¯•æ¥å£è¯´æ˜

### 3.1 æµ‹è¯•æ¥å£

| æ¡†æ¶       | æ¥å£           | è¿”å›å†…å®¹ | å“åº”å¤§å°     |
| -------- | ------------ | ---- | -------- |
| tio-boot | `/plaintext` | çº¯æ–‡æœ¬  | 13 bytes |
| Quarkus  | `/plaintext` | çº¯æ–‡æœ¬  | 13 bytes |

> æœ¬è½®å¯¹æ¯”å·² **ç»Ÿä¸€å“åº”å¤§å°**ï¼Œä¿è¯æµ‹è¯•å…¬å¹³æ€§ã€‚

### 3.2 æµ‹è¯•ä»£ç tio-boot
```java
package com.litongjava.tio.boot.benchmarker.handler;

import com.litongjava.tio.boot.http.TioRequestContext;
import com.litongjava.tio.http.common.HeaderName;
import com.litongjava.tio.http.common.HeaderValue;
import com.litongjava.tio.http.common.HttpRequest;
import com.litongjava.tio.http.common.HttpResponse;
import com.litongjava.tio.http.server.handler.HttpRequestHandler;

public class PlaintextHandler implements HttpRequestHandler {

  private static final String HELLO_WORLD = "Hello, World!";

  private static final byte[] HELLO_WORLD_BYTES = HELLO_WORLD.getBytes();

  @Override
  public HttpResponse handle(HttpRequest httpRequest) throws Exception {
    HttpResponse response = TioRequestContext.getResponse();
    response.setBody(HELLO_WORLD_BYTES);
    response.addHeader(HeaderName.Content_Type, HeaderValue.Content_Type.TEXT_PLAIN_TXT);
    return response;
  }

}

```

### 3.3 æµ‹è¯•ä»£ç quarkus
```java
package org.acme;

import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

@Path("/plaintext")
public class GreetingResource {

  @GET
  @Produces(MediaType.TEXT_PLAIN)
  public String hello() {
    return "Hello, World!";
  }
}
```

---

## 4. æµ‹è¯•ç»“æœæ±‡æ€»
### 4.1 tio-boot æµ‹è¯•ç»“æœ
```
(base) root@debian:~# ab -k -n1000000 -c100 http://127.0.0.1:8080/plaintext
This is ApacheBench, Version 2.3 <$Revision: 1923142 $>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking 127.0.0.1 (be patient)
Completed 100000 requests
Completed 200000 requests
Completed 300000 requests
Completed 400000 requests
Completed 500000 requests
Completed 600000 requests
Completed 700000 requests
Completed 800000 requests
Completed 900000 requests
Completed 1000000 requests
Finished 1000000 requests


Server Software:        -io
Server Hostname:        127.0.0.1
Server Port:            8080

Document Path:          /plaintext
Document Length:        13 bytes

Concurrency Level:      100
Time taken for tests:   4.753 seconds
Complete requests:      1000000
Failed requests:        0
Keep-Alive requests:    1000000
Total transferred:      179000000 bytes
HTML transferred:       13000000 bytes
Requests per second:    210393.61 [#/sec] (mean)
Time per request:       0.475 [ms] (mean)
Time per request:       0.005 [ms] (mean, across all concurrent requests)
Transfer rate:          36777.79 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.0      0       3
Processing:     0    0   0.1      0      13
Waiting:        0    0   0.1      0      13
Total:          0    0   0.1      0      14

Percentage of the requests served within a certain time (ms)
  50%      0
  66%      0
  75%      0
  80%      0
  90%      1
  95%      1
  98%      1
  99%      1
 100%     14 (longest request)
```
### 4.2 quarkus æµ‹è¯•ç»“æœ

```
(base) root@debian:~# ab -k -n1000000 -c100 http://127.0.0.1:8080/plaintext
This is ApacheBench, Version 2.3 <$Revision: 1923142 $>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking 127.0.0.1 (be patient)
Completed 100000 requests
Completed 200000 requests
Completed 300000 requests
Completed 400000 requests
Completed 500000 requests
Completed 600000 requests
Completed 700000 requests
Completed 800000 requests
Completed 900000 requests
Completed 1000000 requests
Finished 1000000 requests


Server Software:        
Server Hostname:        127.0.0.1
Server Port:            8080

Document Path:          /plaintext
Document Length:        13 bytes

Concurrency Level:      100
Time taken for tests:   5.074 seconds
Complete requests:      1000000
Failed requests:        0
Keep-Alive requests:    1000000
Total transferred:      116000000 bytes
HTML transferred:       13000000 bytes
Requests per second:    197072.84 [#/sec] (mean)
Time per request:       0.507 [ms] (mean)
Time per request:       0.005 [ms] (mean, across all concurrent requests)
Transfer rate:          22324.66 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.0      0       3
Processing:     0    1   0.5      0      62
Waiting:        0    1   0.5      0      62
Total:          0    1   0.5      0      62
WARNING: The median and mean for the processing time are not within a normal deviation
        These results are probably not that reliable.
WARNING: The median and mean for the waiting time are not within a normal deviation
        These results are probably not that reliable.
WARNING: The median and mean for the total time are not within a normal deviation
        These results are probably not that reliable.

Percentage of the requests served within a certain time (ms)
  50%      0
  66%      0
  75%      0
  80%      0
  90%      1
  95%      1
  98%      1
  99%      1
 100%     62 (longest request)
```

### 4.3 tio-bootï¼ˆè™šæ‹Ÿçº¿ç¨‹ç‰ˆæœ¬ï¼‰

```
Requests per second:    210,393.61
Time taken:             4.753 s
Mean latency:           0.475 ms
Keep-Alive requests:    1,000,000
P100 (max latency):     14 ms
```

ç‰¹ç‚¹ï¼š

* ååç¨³å®š
* å»¶è¿Ÿåˆ†å¸ƒé›†ä¸­
* å°¾å»¶è¿Ÿéå¸¸ä½

---

### 4.4 Quarkusï¼ˆæœ€æ–°æµ‹è¯•ç»“æœï¼‰

```
Requests per second:    197,072.84
Time taken:             5.074 s
Mean latency:           0.507 ms
Keep-Alive requests:    1,000,000
P100 (max latency):     62 ms
```

ç‰¹ç‚¹ï¼š

* ååç•¥ä½
* å»¶è¿Ÿåˆ†å¸ƒå­˜åœ¨æ˜æ˜¾é•¿å°¾
* ApacheBench ç»™å‡º â€œresults are probably not that reliableâ€ è­¦å‘Šï¼Œè¯´æ˜å°¾éƒ¨æŠ–åŠ¨è¾ƒæ˜æ˜¾

---

## 5. æ ¸å¿ƒæŒ‡æ ‡å¯¹æ¯”

### 5.1 ååé‡ï¼ˆRPSï¼‰

| æ¡†æ¶       | RPS         |
| -------- | ----------- |
| tio-boot | **210,393** |
| Quarkus  | 197,073     |

**tio-boot ååé¢†å…ˆçº¦ï¼š**

[
\frac{210,393}{197,073} \approx \mathbf{1.067}
]

ğŸ‘‰ **çº¦ +6.7%**

---

### 5.2 å¹³å‡å»¶è¿Ÿ

| æ¡†æ¶       | Mean Latency |
| -------- | ------------ |
| tio-boot | **0.475 ms** |
| Quarkus  | 0.507 ms     |

ğŸ‘‰ tio-boot ç•¥ä¼˜ï¼ˆçº¦ 6%ï¼‰

---

### 5.3 å°¾å»¶è¿Ÿï¼ˆå…³é”®å·®å¼‚ï¼‰

| æŒ‡æ ‡          | tio-boot  | Quarkus |
| ----------- | --------- | ------- |
| Max latency | **14 ms** | 62 ms   |

ğŸ‘‰ **Quarkus çš„æœ€æ…¢è¯·æ±‚çº¦ä¸º tio-boot çš„ 4.4 å€**

è¿™ä¹Ÿæ˜¯ ApacheBench å¯¹ Quarkus ç»™å‡º â€œNOT reliable / probably not reliableâ€ è­¦å‘Šçš„ä¸»è¦åŸå› ã€‚

---

## 6. ç»“æœåˆ†æ

### 6.1 ä¸ºä»€ä¹ˆ tio-boot å°¾å»¶è¿Ÿæ›´ä½

* æ›´çŸ­çš„è¯·æ±‚æ‰§è¡Œé“¾è·¯
* æ›´è´´è¿‘ç½‘ç»œå±‚çš„ IO æ¨¡å‹
* æ›´å°‘çš„ä¸­é—´æŠ½è±¡ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢
* åœ¨é«˜é¢‘çŸ­è¯·æ±‚åœºæ™¯ä¸‹æ›´å®¹æ˜“ä¿æŒè°ƒåº¦ç¨³å®š

### 6.2 ä¸ºä»€ä¹ˆ Quarkus ååç•¥ä½ã€å°¾å»¶è¿Ÿæ›´é•¿

* æ›´å®Œæ•´çš„ HTTP / Web æ¡†æ¶èƒ½åŠ›
* æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ã€æ‹¦æˆªå™¨ã€æ‰©å±•ç‚¹
* è®¾è®¡ç›®æ ‡åå‘ **å¼€å‘æ•ˆç‡ä¸ç”Ÿæ€å®Œæ•´æ€§**ï¼Œè€Œéæé™ benchmark

è¿™å±äº**æ¶æ„å–èˆï¼Œè€Œéå®ç°ä¼˜åŠ£**ã€‚

---

## 7. å…³äºè™šæ‹Ÿçº¿ç¨‹çš„å½±å“

åœ¨ tio-boot æµ‹è¯•ä¸­ï¼Œå¼•å…¥è™šæ‹Ÿçº¿ç¨‹åè§‚å¯Ÿåˆ°ï¼š

* ååå°å¹…æå‡ï¼ˆ~3%ï¼‰
* **å°¾å»¶è¿Ÿæ˜¾è‘—ä¸‹é™ï¼ˆP100 ä» 30ms+ é™åˆ° 14msï¼‰**

è¯´æ˜åœ¨ **é«˜å¹¶å‘ã€çŸ­ä»»åŠ¡ã€å¶å‘é˜»å¡** åœºæ™¯ä¸‹ï¼Œè™šæ‹Ÿçº¿ç¨‹å¯¹è°ƒåº¦ç¨³å®šæ€§æœ‰å®é™…ä»·å€¼ã€‚

---

## 8. ç»“è®ºæ€»ç»“

### é€‚åˆé€‰æ‹© tio-boot çš„åœºæ™¯

* é«˜ååã€ä½å»¶è¿Ÿç½‘ç»œæœåŠ¡
* ç½‘å…³ / åè®®æœåŠ¡ / benchmark å‹æ¥å£
* å¯¹ P99 / P100 å»¶è¿Ÿæ•æ„Ÿçš„ç³»ç»Ÿ

### é€‚åˆé€‰æ‹© Quarkus çš„åœºæ™¯

* æ ‡å‡† HTTP / REST æœåŠ¡
* å¾®æœåŠ¡æ¶æ„
* æ›´å…³æ³¨å¼€å‘æ•ˆç‡ã€ç”Ÿæ€ä¸å¯ç»´æŠ¤æ€§

---

## 9. ä¸€å¥è¯ç»“è®º

> åœ¨ç›¸åŒæµ‹è¯•æ¡ä»¶ä¸‹ï¼Œ
> **tio-boot åœ¨ååé‡ä¸Šé¢†å…ˆ Quarkus çº¦ 6â€“7%ï¼Œå¹¶æ˜¾è‘—ä¼˜äºå…¶å°¾å»¶è¿Ÿè¡¨ç°ï¼›
> Quarkus æä¾›æ›´å®Œæ•´çš„ Web èƒ½åŠ›ï¼Œä½†åœ¨æé™æ€§èƒ½åœºæ™¯ä¸‹å­˜åœ¨æ›´æ˜æ˜¾çš„é•¿å°¾ã€‚**

---
