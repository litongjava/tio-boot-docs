# ä½¿ç”¨å·¥å…·åº“ telegram-bot-base å¼€å‘ç¿»è¯‘æœºå™¨äºº

[[toc]]

---

## Maven åæ ‡é…ç½®

åœ¨ Maven å·¥ç¨‹ä¸­å¼•å…¥æ‰€éœ€ä¾èµ–ã€‚ä»¥ä¸‹é…ç½®ä¸­é™¤æ—¥å¿—è®°å½•å’Œ JSON å¤„ç†ä¾èµ–å¤–ï¼Œæ ¸å¿ƒä¾èµ–ä¸º **telegram-bot-base**ã€‚è¯·ç¡®ä¿åœ¨ `pom.xml` ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š

```xml
<dependency>
  <groupId>com.litongjava</groupId>
  <artifactId>tio-boot-admin</artifactId>
  <version>1.0.0</version>
</dependency>
<dependency>
  <groupId>com.litongjava</groupId>
  <artifactId>telegram-bot-base</artifactId>
  <version>1.0.0</version>
</dependency>
<dependency>
  <groupId>ch.qos.logback</groupId>
  <artifactId>logback-classic</artifactId>
  <version>1.4.12</version>
</dependency>
<!-- Jackson Core åº“ï¼Œç”¨äº JSON å¤„ç† -->
<dependency>
  <groupId>com.fasterxml.jackson.core</groupId>
  <artifactId>jackson-core</artifactId>
  <version>2.17.2</version>
</dependency>
```

> **è¯´æ˜**  
> å…¶ä¸­ `telegram-bot-base` æ˜¯å¯¹ telegram-bots çš„å¸¸ç”¨æ“ä½œè¿›è¡Œå°è£…çš„å·¥å…·åº“ï¼Œç”¨ä»¥é™ä½å¼€å‘éš¾åº¦ã€‚

---

## ç¯å¢ƒé…ç½®ä¸æ•´åˆ TioBoot

### .env é…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `.env` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µå¡«å†™ API KEY ä¸ Bot Token ç­‰é…ç½®ä¿¡æ¯ï¼‰ï¼š

```dotenv
GEMINI_API_KEY=
telegram.bot.token=
telegram.bot.webhook=https://xxx.dev/telegram/webhook
```

### TelegramBotConfig é…ç½®

åœ¨éç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨é•¿è½®è¯¢æ¨¡å¼ï¼Œç”Ÿäº§ç¯å¢ƒåˆ™ä½¿ç”¨ WebHook æ¨¡å¼ã€‚ä¸‹é¢çš„ `TelegramBotConfig` ç±»å±•ç¤ºäº†å¦‚ä½•åœ¨ TioBoot æ¡†æ¶ä¸­è‡ªåŠ¨åŠ è½½é…ç½®å¹¶æ³¨å†Œ Botï¼š

```java
package com.litongjava.manim.config;

import org.telegram.telegrambots.longpolling.TelegramBotsLongPollingApplication;
import org.telegram.telegrambots.meta.exceptions.TelegramApiException;
import com.litongjava.annotation.AConfiguration;
import com.litongjava.annotation.Initialization;
import com.litongjava.hook.HookCan;
import com.litongjava.manim.bots.MyAmazingBot;
import com.litongjava.tio.utils.environment.EnvUtils;

@AConfiguration
public class TelegramBotConfig {

  @Initialization
  public void config() {
    // éç”Ÿäº§ç¯å¢ƒä¸‹é‡‡ç”¨é•¿è½®è¯¢æ¨¡å¼ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨ WebHook æ¨¡å¼
    if (!EnvUtils.isProd()) {
      String botAuthToken = EnvUtils.getStr("telegram.bot.token");
      TelegramBotsLongPollingApplication botsApplication = new TelegramBotsLongPollingApplication();

      try {
        // æ³¨å†Œè‡ªå®šä¹‰ Bot
        MyAmazingBot updatesConsumer = new MyAmazingBot();
        botsApplication.registerBot(botAuthToken, updatesConsumer);
      } catch (TelegramApiException e) {
        e.printStackTrace();
      }

      // åº”ç”¨å…³é—­æ—¶æ³¨é”€ Bot å¹¶å…³é—­åº”ç”¨
      HookCan.me().addDestroyMethod(() -> {
        try {
          botsApplication.unregisterBot(botAuthToken);
          botsApplication.close();
        } catch (Exception e) {
          e.printStackTrace();
        }
      });
    }
  }
}
```

### TelegramClientConfig é…ç½®

è¯¥ç±»ç”¨äºåˆå§‹åŒ– Telegram Clientï¼ˆæ­¤å¤„ä½¿ç”¨ OkHttp å®ç°ï¼‰å¹¶å°†å…¶å®ä¾‹èµ‹å€¼ç»™å…¨å±€å˜é‡ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨å‘é€æ¶ˆæ¯ç­‰æ“ä½œï¼š

```java
package com.litongjava.manim.config;

import org.telegram.telegrambots.client.okhttp.OkHttpTelegramClient;
import org.telegram.telegrambots.meta.generics.TelegramClient;
import com.litongjava.annotation.AConfiguration;
import com.litongjava.annotation.Initialization;
import com.litongjava.telegram.can.TelegramClientCan;
import com.litongjava.tio.utils.environment.EnvUtils;

@AConfiguration
public class TelegramClientConfig {

  @Initialization
  public void config() {
    String botAuthToken = EnvUtils.getStr("telegram.bot.token");
    TelegramClient telegramClient = new OkHttpTelegramClient(botAuthToken);
    TelegramClientCan.main = telegramClient;
  }
}
```

---

## æ ¸å¿ƒ Bot é€»è¾‘å®ç°

### MyAmazingBot ç¤ºä¾‹

ä¸‹é¢å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„ Bot ç¤ºä¾‹ç±» `MyAmazingBot`ï¼Œæ­¤ç±»ç»§æ‰¿è‡ª `LongPollingMultiThreadUpdateConsumer`ï¼Œç”¨äºæ¥æ”¶æ›´æ–°å¹¶æ ¹æ®æŒ‡ä»¤è¿›è¡Œè·¯ç”±åˆ†å‘ï¼š

```java
package com.litongjava.manim.bots;

import java.util.List;
import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
import org.telegram.telegrambots.meta.api.objects.Update;
import com.litongjava.jfinal.aop.Aop;
import com.litongjava.telegram.bot.service.GetChatIdService;
import com.litongjava.telegram.can.TelegramClientCan;
import com.litongjava.telegram.utils.LongPollingMultiThreadUpdateConsumer;
import lombok.extern.slf4j.Slf4j;

@Slf4j
public class MyAmazingBot extends LongPollingMultiThreadUpdateConsumer {
  @Override
  public void consume(Update update) {
    if (update.hasMessage() && update.getMessage().hasText()) {
      String receivedText = update.getMessage().getText();
      Long chatId = update.getMessage().getChatId();
      log.info("Received text message: {}", receivedText);

      // æ ¹æ®æŒ‡ä»¤è¿›è¡Œè·¯ç”±åˆ†å‘
      if ("/get_chat_id".equals(receivedText)) {
        Aop.get(GetChatIdService.class).index(update);
      } else if ("/start".equals(receivedText)) {
        Aop.get(StartService.class).index(update);
      } else if ("/about".equals(receivedText)) {
        Aop.get(StartService.class).about(update);
      } else {
        // é»˜è®¤å°†æ¥æ”¶åˆ°çš„æ–‡æœ¬åŸæ ·å›å‘
        SendMessage sendMessage = new SendMessage(chatId.toString(), receivedText);
        TelegramClientCan.execute(sendMessage);
      }
    }
  }

  @Override
  public void consumeGroup(List<Update> updates) {
    for (Update update : updates) {
      this.consume(update);
    }
  }
}
```

### åˆ©ç”¨å·¥å…·åº“è·å– chat_id

ä»¥ä¸‹ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡å·¥å…·åº“æå–æ›´æ–°ä¸­çš„ `chat_id` å¹¶å°†å…¶è¿”å›ç»™ç”¨æˆ·ï¼ˆé€‚ç”¨äºç§èŠå’Œé¢‘é“æ¶ˆæ¯ï¼‰ï¼š

```java
package com.litongjava.gpt.translator.bots;

import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
import org.telegram.telegrambots.meta.api.objects.Update;
import org.telegram.telegrambots.meta.api.objects.chat.Chat;
import com.litongjava.telegram.utils.TelegramClientCan;

public class GetChatIdService {

  public void index(Update update) {
    Chat chat = null;
    if (update.hasMessage()) {
      chat = update.getMessage().getChat();
    } else if (update.hasChannelPost()) {
      chat = update.getChannelPost().getChat();
    }

    // è·å– chat_idï¼ˆæ•°æ®å·²è„±æ•ï¼‰
    Long chatId = chat.getId();

    // ä»¥æ¶ˆæ¯å½¢å¼è¿”å› chat_id
    SendMessage sendMessage = new SendMessage(chatId.toString(), chatId.toString());
    TelegramClientCan.execute(sendMessage);
  }
}
```

---

## å‘é€ Markdown æ ¼å¼æ¶ˆæ¯

å·¥å…·åº“ä¸­æä¾›äº†ä¾¿æ·æ–¹æ³•å¸®åŠ©å¼€å‘è€…æ„é€ æ”¯æŒ Markdown è¯­æ³•çš„æ¶ˆæ¯ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ç»“åˆ AOP å®ç°åŸºäºå‘½ä»¤çš„æ¶ˆæ¯è·¯ç”±ä¸å›å¤ã€‚

### StartService å¤„ç† /start ä¸ /about æŒ‡ä»¤

`StartService` ç±»ä¸»è¦è´Ÿè´£å¤„ç† `/start` å’Œ `/about` æŒ‡ä»¤ï¼Œæ„é€  Markdown æ ¼å¼æ¶ˆæ¯å¹¶é€šè¿‡ TelegramClient å‘é€ï¼š

```java
package com.litongjava.manim.services;

import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
import org.telegram.telegrambots.meta.api.objects.Update;
import com.litongjava.telegram.can.TelegramClientCan;
import com.litongjava.telegram.utils.SendMessageUtils;

public class StartService {

  public void index(Update update) {
    Long chatId = update.getMessage().getChatId();
    String welcomeMessage = "ğŸŒ **æ•™å­¦æœºå™¨äºº** ğŸŒ\n\n" +
                            "è¿™ä¸ªæœºå™¨äººä½¿ç”¨ AI æŠ€æœ¯ä¸ºæ‚¨æä¾›é«˜è´¨é‡çš„è§†é¢‘ç”ŸæˆæœåŠ¡ã€‚æ¬¢è¿ä½¿ç”¨æ•™å­¦æœºå™¨äººï¼\n\n";
    // é€šè¿‡å·¥å…·åº“ç”Ÿæˆ Markdown æ ¼å¼æ¶ˆæ¯
    SendMessage markdown = SendMessageUtils.markdown(chatId, welcomeMessage);
    TelegramClientCan.execute(markdown);
  }

  public void about(Update update) {
    Long chatId = update.getMessage().getChatId();
    String aboutMessage = "**å¼€å‘è€…:** Litong Java\n" +
                          "**ç‰ˆæœ¬:** 1.0.0\n\n" +
                          "æ„Ÿè°¢æ‚¨ä½¿ç”¨æœ¬æœºå™¨äººï¼";
    SendMessage markdown = SendMessageUtils.markdown(chatId, aboutMessage);
    TelegramClientCan.execute(markdown);
  }
}
```

> **äº®ç‚¹è¯´æ˜**
>
> - åˆ©ç”¨ `SendMessageUtils.markdown` æ–¹æ³•å¿«é€Ÿæ„é€ æ”¯æŒ Markdown æ ¼å¼çš„æ¶ˆæ¯ã€‚
> - ä½¿ç”¨ AOP æ¡†æ¶è°ƒç”¨ `GetChatIdService` ä¸ `StartService`ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘æ¨¡å—åŒ–ï¼Œé™ä½è€¦åˆåº¦ã€‚

---

## å¼€å‘ç¿»è¯‘æœºå™¨äºº

æœ¬èŠ‚å±•ç¤ºå¦‚ä½•å¼€å‘ä¸€ä¸ªæ”¯æŒæ–‡æœ¬ç¿»è¯‘åŠŸèƒ½çš„ Telegram Botï¼Œå…¶ä¸»è¦é€»è¾‘åŒ…æ‹¬ï¼š

- å½“æ¥æ”¶åˆ°éé¢„å®šä¹‰æŒ‡ä»¤çš„æ–‡æœ¬æ¶ˆæ¯æ—¶ï¼ˆä»…é’ˆå¯¹ç§èŠç”Ÿæ•ˆï¼‰ï¼›
- æ ¹æ®æ–‡æœ¬å†…å®¹åˆ¤æ–­è¯­è¨€æ–¹å‘ï¼ˆä¾‹å¦‚ï¼šè‹¥åŒ…å«ä¸­æ–‡ï¼Œåˆ™è§†ä¸ºä¸­è¯‘è‹±ï¼›å¦åˆ™è‹±è¯‘ä¸­ï¼‰ï¼›
- è°ƒç”¨ç¿»è¯‘æœåŠ¡ï¼Œå¹¶å°†ç¿»è¯‘ç»“æœä»¥ Markdown æ ¼å¼è¿”å›ç»™ç”¨æˆ·ã€‚

### ç¿»è¯‘æç¤ºæ¨¡æ¿

åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªæç¤ºæ¨¡æ¿æ–‡ä»¶ `translator_prompt.txt`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```txt
You are a helpful translator.
- Please translate the following #(src_lang) into #(dst_lang).
- Preserve the format of the source content during translation.
- Do not provide any explanations or text apart from the translation.
- Only output the translated text

text:#(source_text)

translated text:
```

### ç§èŠæ¶ˆæ¯è·¯ç”±å®ç°

é’ˆå¯¹ç§èŠæ¶ˆæ¯ï¼ŒBot å¯¹éé¢„å®šä¹‰æŒ‡ä»¤çš„æ–‡æœ¬è½¬å‘ç»™ç¿»è¯‘æœåŠ¡ã€‚ä¸‹é¢æ˜¯ä¿®æ”¹åçš„ `MyAmazingBot` å®ç°ï¼Œé’ˆå¯¹ç§èŠæ¶ˆæ¯è°ƒç”¨ç¿»è¯‘æ¨¡å—ï¼š

```java
package com.litongjava.manim.bots;

import java.util.List;
import org.telegram.telegrambots.meta.api.objects.Update;
import com.litongjava.jfinal.aop.Aop;
import com.litongjava.manim.services.BotMessageDispatherService;
import com.litongjava.manim.services.StartService;
import com.litongjava.telegram.bot.service.GetChatIdService;
import com.litongjava.telegram.utils.ChatType;
import com.litongjava.telegram.utils.LongPollingMultiThreadUpdateConsumer;
import lombok.extern.slf4j.Slf4j;

@Slf4j
public class MyAmazingBot extends LongPollingMultiThreadUpdateConsumer {
  @Override
  public void consume(Update update) {
    if (update.hasMessage() && update.getMessage().hasText()) {
      String receivedText = update.getMessage().getText();
      log.info("Received text message: {}", receivedText);

      // æ ¹æ®æŒ‡ä»¤è¿›è¡Œè·¯ç”±åˆ†å‘
      if ("/get_chat_id".equals(receivedText)) {
        Aop.get(GetChatIdService.class).index(update);
      } else if ("/start".equals(receivedText)) {
        Aop.get(StartService.class).index(update);
      } else if ("/about".equals(receivedText)) {
        Aop.get(StartService.class).about(update);
      } else {
        // å½“æ¶ˆæ¯æ¥æºä¸ºç§èŠæ—¶ï¼Œè°ƒç”¨ç¿»è¯‘æœåŠ¡å¤„ç†æ–‡æœ¬
        if (update.getMessage().getChat().getType().equals(ChatType.chat_private)) {
          Aop.get(BotMessageDispatherService.class).index(update);
        }
      }
    }
  }

  @Override
  public void consumeGroup(List<Update> updates) {
    for (Update update : updates) {
      this.consume(update);
    }
  }
}
```

`BotMessageDispatherService` çš„å®ç°éå¸¸ç®€å•ï¼Œä»…å¯¹æ¥ç¿»è¯‘æœåŠ¡ï¼š

```java
package com.litongjava.manim.services;

import org.telegram.telegrambots.meta.api.objects.Update;
import com.litongjava.jfinal.aop.Aop;

public class BotMessageDispatherService {

  public void index(Update update) {
    Aop.get(BotTranslateService.class).index(update);
  }
}
```

### BotTranslateService å®ç°

`BotTranslateService` ç±»ä¸»è¦è´Ÿè´£ï¼š

1. è·å–æ¶ˆæ¯æ–‡æœ¬ä¸èŠå¤©ä¿¡æ¯ï¼›
2. åˆ¤æ–­æ–‡æœ¬åŒ…å«ä¸­æ–‡å­—ç¬¦åˆ™è®¾ç½®æºè¯­è¨€ä¸ºä¸­æ–‡ã€ç›®æ ‡è¯­è¨€ä¸ºè‹±æ–‡ï¼ˆå¦åˆ™åä¹‹ï¼‰ï¼›
3. æ„é€ ç¿»è¯‘è¯·æ±‚å¯¹è±¡ï¼Œè°ƒç”¨ç¿»è¯‘æœåŠ¡ï¼›
4. æ•è·å¼‚å¸¸å¹¶è¿”å›é”™è¯¯æç¤ºï¼ˆè‹¥æœ‰å¼‚å¸¸ï¼‰ï¼›
5. ä½¿ç”¨ `SendMessageUtils.markdown` æ–¹æ³•æ„é€  Markdown æ ¼å¼æ¶ˆæ¯å¹¶å›å¤ç”¨æˆ·ã€‚

```java
package com.litongjava.manim.services;

import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
import org.telegram.telegrambots.meta.api.objects.Update;
import org.telegram.telegrambots.meta.api.objects.chat.Chat;
import com.litongjava.jfinal.aop.Aop;
import com.litongjava.manim.vo.TranslatorTextVo;
import com.litongjava.telegram.can.TelegramClientCan;
import com.litongjava.telegram.utils.SendMessageUtils;
import lombok.extern.slf4j.Slf4j;

@Slf4j
public class BotTranslateService {

  public void index(Update update) {
    String text = update.getMessage().getText();
    Chat chat = update.getMessage().getChat();
    Long chatId = chat.getId();

    // æ ¹æ®æ–‡æœ¬åˆ¤æ–­è¯­è¨€æ–¹å‘ï¼šåŒ…å«ä¸­æ–‡åˆ™ä¸ºä¸­è¯‘è‹±ï¼Œå¦åˆ™ä¸ºè‹±è¯‘ä¸­
    String srcLang;
    String destLang;
    if (containsChinese(text)) {
      srcLang = "Chinese";
      destLang = "English";
    } else {
      srcLang = "English";
      destLang = "Chinese";
    }

    // æ„é€ ç¿»è¯‘è¯·æ±‚å¯¹è±¡
    TranslatorTextVo translatorTextVo = new TranslatorTextVo();
    translatorTextVo.setSrcText(text);
    translatorTextVo.setSrcLang(srcLang);
    translatorTextVo.setDestLang(destLang);

    String responseText;
    try {
      // è°ƒç”¨ç¿»è¯‘æœåŠ¡è·å–ç¿»è¯‘ç»“æœ
      responseText = Aop.get(TranslatorService.class).translate(chatId.toString(), translatorTextVo);
    } catch (Exception e) {
      log.error("Exception", e);
      responseText = "Exception: " + e.getMessage();
    }

    // æ„é€  Markdown æ ¼å¼æ¶ˆæ¯å‘é€ç¿»è¯‘ç»“æœå›ç”¨æˆ·
    SendMessage markdown = SendMessageUtils.markdown(chatId, responseText);
    TelegramClientCan.execute(markdown);
  }

  /**
   * åˆ¤æ–­è¾“å…¥æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦
   *
   * @param text è¾“å…¥çš„æ–‡æœ¬å†…å®¹
   * @return è‹¥åŒ…å«ä¸­æ–‡å­—ç¬¦è¿”å› trueï¼Œå¦åˆ™è¿”å› false
   */
  private boolean containsChinese(String text) {
    if (text == null || text.isEmpty()) {
      return false;
    }
    // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸­æ–‡å­—ç¬¦èŒƒå›´
    return text.matches(".*[\\u4e00-\\u9fa5]+.*");
  }
}
```

### ç¿»è¯‘æœåŠ¡å®ç°

`TranslatorService` ç±»åˆ©ç”¨é¢„å®šä¹‰çš„ç¿»è¯‘æç¤ºæ¨¡æ¿è°ƒç”¨ç¿»è¯‘å¼•æ“ï¼ˆæœ¬ç¤ºä¾‹ä¸­ä½¿ç”¨ Gemini æ¨¡å‹ï¼‰ã€‚è¯·ç¡®ä¿é¡¹ç›®ä¸­å·²å®ç°å…·ä½“è°ƒç”¨é€»è¾‘ï¼Œæ­¤å¤„ä»…å±•ç¤ºæ¥å£è°ƒç”¨è¿‡ç¨‹ï¼š

```java
package com.litongjava.manim.services;

import java.util.HashMap;
import java.util.Map;
import com.jfinal.template.Template;
import com.litongjava.gemini.GeminiClient;
import com.litongjava.gemini.GoogleGeminiModels;
import com.litongjava.manim.vo.TranslatorTextVo;
import com.litongjava.template.PromptEngine;

public class TranslatorService {

  public String translate(TranslatorTextVo translatorTextVo) {
    String srcLang = translatorTextVo.getSrcLang();
    String destLang = translatorTextVo.getDestLang();
    String srcText = translatorTextVo.getSrcText();

    Template template = PromptEngine.getTemplate("translator_prompt.txt");
    Map<String, String> values = new HashMap<>();

    values.put("src_lang", srcLang);
    values.put("dst_lang", destLang);
    values.put("source_text", srcText);

    String prompt = template.renderToString(values);
    String response = GeminiClient.chatWithModel(GoogleGeminiModels.GEMINI_2_0_FLASH_EXP, "user", prompt);
    return response;
  }

  public String translate(String chatId, TranslatorTextVo translatorTextVo) {
    // æ­¤å¤„ç›´æ¥è°ƒç”¨é‡è½½æ–¹æ³•å®ç°ç¿»è¯‘
    return this.translate(translatorTextVo);
  }
}
```

---

## ä½¿ç”¨ WebHook æ¨¡å¼

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®é‡‡ç”¨ WebHook æ¨¡å¼ä»¥è·å¾—æ›´é«˜çš„å¹¶å‘æ€§èƒ½ã€‚ä¸‹é¢ç»™å‡ºè®¾ç½®å’Œå¤„ç† WebHook çš„ç¤ºä¾‹ï¼š

### è®¾ç½® WebHook ç¤ºä¾‹

```java
package com.litongjava.manim.services;

import org.junit.Test;
import com.litongjava.model.http.response.ResponseVo;
import com.litongjava.tio.utils.environment.EnvUtils;
import com.litongjava.tio.utils.json.JsonUtils;
import com.litongjava.tio.utils.telegram.TelegramBot;

public class TelegramBotWebHookTest {

  @Test
  public void test() {
    EnvUtils.load();
    String token = EnvUtils.getStr("telegram.bot.token");
    String webHook = EnvUtils.getStr("telegram.bot.webhook");
    System.out.println(token);
    System.out.println(webHook);
    TelegramBot telegramBot = new TelegramBot("main", token);

    // è®¾ç½® WebHook
    ResponseVo setWebhook = telegramBot.setWebhook(webHook);
    System.out.println("Set WebHook Response: " + JsonUtils.toJson(setWebhook));

    // è·å– WebHook ä¿¡æ¯
    ResponseVo webhookInfo = telegramBot.getWebhookInfo();
    System.out.println("Webhook Info: " + JsonUtils.toJson(webhookInfo));

    // å¦‚æœ‰éœ€è¦ï¼Œå¯åˆ é™¤ WebHook
    // ResponseVo deleteWebhook = telegramBot.deleteWebhook();
    // System.out.println("Delete WebHook Response: " + JsonUtils.toJson(deleteWebhook));
  }
}
```

### WebHook æ§åˆ¶å™¨å®ç°

ä¸‹é¢çš„æ§åˆ¶å™¨æ¥æ”¶ç”± Telegram æ¨é€çš„æ›´æ–°ï¼Œå¹¶å°†å…¶äº¤ç”±ä¸šåŠ¡æ¨¡å—å¤„ç†ï¼š

```java
package com.litongjava.manim.controller;

import org.telegram.telegrambots.meta.api.objects.Update;
import com.litongjava.annotation.RequestPath;
import com.litongjava.jfinal.aop.Aop;
import com.litongjava.manim.services.BotMessageDispatherService;
import com.litongjava.tio.boot.http.TioRequestContext;
import com.litongjava.tio.http.common.HttpRequest;
import com.litongjava.tio.http.common.HttpResponse;
import com.litongjava.tio.utils.json.JacksonUtils;

@RequestPath("/telegram")
public class TelegramWebhookController {

  @RequestPath("/webhook")
  public HttpResponse handleTelegramWebhook(HttpRequest request) {
    String bodyString = request.getBodyString();
    Update update = JacksonUtils.parse(bodyString, Update.class);
    Aop.get(BotMessageDispatherService.class).index(update);
    return TioRequestContext.getResponse();
  }
}
```

---

## æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨ **telegram-bot-base** å·¥å…·åº“åŠ TioBoot æ¶æ„å¿«é€Ÿå¼€å‘ Telegram Bot åº”ç”¨ã€‚ä¸»è¦å†…å®¹åŒ…æ‹¬ï¼š

- **Maven åæ ‡é…ç½®**ï¼šå¦‚ä½•å¼•å…¥æ‰€éœ€ä¾èµ–ã€‚
- **ç¯å¢ƒé…ç½®ä¸ Bot åˆå§‹åŒ–**ï¼šé€šè¿‡ `.env` é…ç½®æ–‡ä»¶å’Œç›¸åº”çš„é…ç½®ç±»ï¼ˆå¦‚ `TelegramBotConfig`ã€`TelegramClientConfig`ï¼‰å®ç°ç¯å¢ƒåŠ è½½ä¸ Bot æ³¨å†Œã€‚
- **æ¶ˆæ¯å¤„ç†**ï¼šæ¼”ç¤ºäº†å¦‚ä½•è·å–èŠå¤© IDã€å‘é€ Markdown æ ¼å¼æ¶ˆæ¯ï¼Œä»¥åŠæ ¹æ®æŒ‡ä»¤ï¼ˆå¦‚ `/start`ã€`/about`ï¼‰åˆ†å‘ä¸šåŠ¡é€»è¾‘ã€‚
- **ç¿»è¯‘æœºå™¨äººå¼€å‘**ï¼šåŸºäºç§èŠæ¶ˆæ¯çš„è¯­è¨€è¯†åˆ«ä¸ç¿»è¯‘è°ƒç”¨ï¼Œå®ç°æ™ºèƒ½ç¿»è¯‘å¹¶ä»¥ Markdown æ ¼å¼å›å¤ç”¨æˆ·ã€‚
- **WebHook æ¨¡å¼**ï¼šä»‹ç»äº† WebHook çš„è®¾ç½®ã€è·å–ä¿¡æ¯åŠæ§åˆ¶å™¨å®ç°ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚

å¸Œæœ›æœ¬æŒ‡å—èƒ½å¤Ÿä¸ºæ‚¨æ„å»ºé«˜æ•ˆã€å¯é çš„ Telegram Bot åº”ç”¨æä¾›æœ‰åŠ›æ”¯æŒã€‚å¦‚éœ€æ‰©å±•æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚æ¥å…¥å…¶å®ƒç¿»è¯‘å¼•æ“ã€æ”¯æŒæ›´å¤šæ¶ˆæ¯ç±»å‹ï¼‰ï¼Œå¯åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚

---
